name: Publicar Juego

on:
  push:
    branches:
      - main
    tags:
      - 'v*'
  workflow_dispatch:

jobs:
  build-and-release:
    runs-on: windows-latest
    
    steps:
    - name: Checkout del cÃ³digo
      uses: actions/checkout@v3
      
    - name: Configurar MSYS2
      uses: msys2/setup-msys2@v2
      with:
        msystem: MINGW64
        update: true
        install: >-
          mingw-w64-x86_64-gcc
          mingw-w64-x86_64-sfml
          mingw-w64-x86_64-box2d
          make
    
    - name: Compilar el juego
      shell: msys2 {0}
      run: |
        make run18_DinoRevengeSelect
    
    - name: Crear paquete de distribuciÃ³n
      shell: pwsh
      run: |
        New-Item -ItemType Directory -Force -Path "release"
        Copy-Item "bin/18_DinoRevengeSelect.exe" -Destination "release/PockyMan.exe"
        Copy-Item -Recurse "assets" -Destination "release/assets"
        Copy-Item "README.md" -Destination "release/"
        Copy-Item "gallery/cover.png" -Destination "release/"
        Compress-Archive -Path "release/*" -DestinationPath "PockyMan-Asalto-Pokeplaza-Windows.zip"
    
    - name: Subir artefacto
      uses: actions/upload-artifact@v3
      with:
        name: PockyMan-Windows
        path: PockyMan-Asalto-Pokeplaza-Windows.zip
    
    - name: Crear Release (si es un tag)
      if: startsWith(github.ref, 'refs/tags/')
      uses: softprops/action-gh-release@v1
      with:
        files: PockyMan-Asalto-Pokeplaza-Windows.zip
        body: |
          ## PockyMan: Asalto a la Pokeplaza
          
          ### ðŸŽ® VersiÃ³n Windows
          Descarga el archivo ZIP, extrÃ¡elo y ejecuta `PockyMan.exe`
          
          ### ðŸ“‹ Requisitos
          - Windows 10/11
          - Carpeta `assets` debe estar en el mismo directorio que el ejecutable
          
          ### ðŸŽ¯ Controles
          - A/D o Flechas: Movimiento
          - Space: Saltar
          - S/Abajo: Agacharse / Acelerar caÃ­da
          - R o Clic Izquierdo: Disparar
          - P/ESC: Pausar
          
          Â¡Disfruta el juego!
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
